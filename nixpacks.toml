# Nixpacks build plan for MCP Agent Mail

[variables]
PORT = "8765"

[phases.setup]
# Ensure common build tools are present; include curl to fetch uv binary installer
nixPkgs = ["gcc", "openssl", "pkg-config", "curl"]

[phases.install]
# Install uv as a standalone binary (no system Python needed), then provision Python 3.14 and sync
cmds = [
  "curl -LsSf https://astral.sh/uv/install.sh | sh",
  "export PATH=$HOME/.local/bin:$PATH && $HOME/.local/bin/uv python install 3.14",
  "UV_PYTHON=3.14 UV_PYTHON_DOWNLOADS=true $HOME/.local/bin/uv sync --no-dev --frozen"
]

[start]
# Prefer the explicit HTTP app factory entrypoint
cmd = "uvicorn mcp_agent_mail.http:build_http_app --factory --host 0.0.0.0 --port ${PORT:-8765}"